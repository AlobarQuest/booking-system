{% extends "base.html" %}
{% block title %}Book an Appointment{% endblock %}
{% block header_title %}Schedule Your Appointment{% endblock %}
{% block header_subtitle %}Select a type below and pick a time that works for you{% endblock %}
{% block content %}

<div class="steps">
  <div class="step active" id="step1">
    <span class="step-num">1</span> Type
  </div>
  <div class="step-divider"></div>
  <div class="step" id="step2">
    <span class="step-num">2</span> Time
  </div>
  <div class="step-divider"></div>
  <div class="step" id="step3">
    <span class="step-num">3</span> Details
  </div>
</div>

<div id="type-selection">
  {% for appt in appointment_types %}
  <div class="card" onclick="selectType({{ appt.id }}, this)">
    <h3>{{ appt.name }}</h3>
    <div class="card-meta">
      {% if appt.description %}<span>{{ appt.description }}</span>{% endif %}
      <span class="card-duration">&#9679; {{ appt.duration_minutes }} min</span>
    </div>
  </div>
  {% endfor %}
</div>

<div id="date-picker-area" style="display:none;" class="section">
  <label class="section-label" for="date-input">Choose a date</label>
  <input type="date" id="date-input"
    min="{{ min_date }}" max="{{ max_date }}"
    hx-get="/slots"
    hx-include="[name='type_id']"
    hx-target="#slots-area"
    hx-swap="innerHTML"
    hx-trigger="change"
    name="date">
  <input type="hidden" name="type_id" id="type_id_input" value="">
</div>

<div id="slots-area" class="section"></div>
<div id="booking-form-area" class="section"></div>

<script>
function selectType(id, el) {
  document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('type_id_input').value = id;
  document.getElementById('date-picker-area').style.display = 'block';
  document.getElementById('slots-area').innerHTML = '';
  document.getElementById('booking-form-area').innerHTML = '';
  document.getElementById('date-input').value = '';
  document.getElementById('step2').classList.add('active');
}
function selectSlot(el) {
  document.querySelectorAll('.slot-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('step3').classList.add('active');
}
</script>
{% endblock %}
